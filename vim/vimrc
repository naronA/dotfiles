set encoding=utf-8
scriptencoding utf-8
set completeopt+=noselect
" set virtualedit=block

""""" [検索系]
set ignorecase                  " 大文字小文字を区別しない
set smartcase                   " 検索文字に大文字がある場合は大文字小文字を区別
set incsearch                   " インクリメンタルサーチ
set hlsearch                    " 検索マッチテキストをハイライト

""""" [編集系]
set hidden                      " バッファを閉じる代わりに隠す（Undo履歴を残すため）
set switchbuf=useopen           " 新しく開く代わりにすでに開いてあるバッファを開く
set showmatch                   " 対応する括弧などをハイライト表示する
set matchtime=2                 " 対応括弧のハイライト表示を3秒にする
set nowritebackup               " Backupを無効化
set nobackup                    " Backupを無効化
set noswapfile                  " swapを無効化
set backspace=0
" set backspace=indent,eol,start  " バックスペースでなんでも消せるようにする
set clipboard+=unnamedplus

""""" [表示系]
set number                      " 行番号の表示
set nowrap                      " 長いテキストの折り返し
set textwidth=0                 " 自動的に改行が入るのを無効化
set colorcolumn=80,120              " その代わり80文字目にラインを入れる
set t_vb=
set novisualbell                " 前時代的スクリーンベルを無効化
set display=lastline
set pumheight=15

set ambiwidth=double
set softtabstop=0
set showtabline=2               " 常にタブラインを表示
set laststatus=2
set whichwrap=b,s,<,>,[,]       " wrapするカッコ一覧
set list                        " 不可視文字の可視化
set listchars=tab:\|\ ,trail:￭,extends:❯,precedes:❮ ",nbsp:%,eol:￭¬↲ "不可視文字をUnicodeにする
set ttimeout
set ttimeoutlen=10
set scrolloff=5                 " 3行残して画面スクロールする
set shell=zsh
set cursorline

if  exists('$TMUX')
	set notermguicolors
else
	set termguicolors
endif

" set iminsert=0
" set imsearch=0
" set lazyredraw
"
if exists('veonim')
	"config lol
	let g:vn_font = 'Cica'
	let g:vn_font_size = 15
	let g:vn_line_height = '1.0'
endif

let mapleader = "\<Space>"

if ! has('nvim')
" OptionキーをMetaキーとして使う。
    let s:c = 'a'
    while s:c <=# 'z'
        execute 'set <M-' . s:c . '>=\e' . s:c
        execute 'imap \e' . s:c . ' <M-' . s:c . '>'
        execute 'set <M-S-' . s:c . '>=\e' . toupper(s:c)
        execute 'imap \e' . toupper(s:c) . ' <M-' . s:c . '>'
        let s:c = nr2char(1+char2nr(s:c))
    endw
endif

""""" key remap
nnoremap <silent> <ESC><ESC> :noh<CR>
nnoremap <silent> <M-p> :bp<CR>
nnoremap <silent> <M-n> :bn<CR>
nnoremap <silent> <M-d> :bd<CR>
nnoremap <silent> [b :bprevious<CR>
nnoremap <silent> ]b :bnext<CR>
nnoremap <silent> [B :bfirst<CR>
nnoremap <silent> ]B :blast<CR>

" バックスラッシュやクエスチョンを状況に合わせ自動的にエスケープ
cnoremap <expr> / getcmdtype() == '/' ? '\/' : '/'
cnoremap <expr> ? getcmdtype() == '?' ? '\?' : '?'

" vim strict mode
vnoremap  <C-c>    <nop>
vnoremap  <Up>     <nop>
vnoremap  <Down>   <nop>
vnoremap  <Left>   <nop>
vnoremap  <Right>  <nop>
inoremap  <C-c>    <nop>
inoremap  <Up>     <nop>
inoremap  <Down>   <nop>
inoremap  <Left>   <nop>
inoremap  <Right>  <nop>
inoremap  <BS>     <nop>
noremap   <C-c>    <nop>
noremap   <Up>     <nop>
noremap   <Down>   <nop>
noremap   <Left>   <nop>
noremap   <Right>  <nop>
"noremap   h <nop>
"noremap   l <nop>
tnoremap <C-j><C-j> <C-\><C-n>

inoremap  <C-l> <DEL>
""""" command """""
" よく押し間違えるので
command! Q :q
command! W :w
command! Wq :wq
command! WQ :wq

if has('gui_macvim')
    """"" MacVimのMetaキー有効化
    set macmeta " enables option as meta key in macvim. Needed for auto-pairs mappings <M-e> etc.
    if has('mac')
        set guifont=Cica:h16
    endif
endif

""""" gui font  """""
if has('gui_running')
    if has('unix') && !has('mac')
        set guifont=Cica\ 16
    endif
endif

"""""" dein (load plugins)"""""
let s:dein_dir = expand('~/.cache/dein')
let s:dein_repo_dir = s:dein_dir . '/repos/github.com/Shougo/dein.vim'

" dein.vim がなければ github から落としてくる
if &runtimepath !~# '/dein.vim'
    if !isdirectory(s:dein_repo_dir)
        execute '!git clone https://github.com/Shougo/dein.vim' s:dein_repo_dir
    endif
    execute 'set runtimepath^=' . fnamemodify(s:dein_repo_dir, ':p')
endif

" もし設定のキャッシュファイルを読み込めなかったら
" tomlファイルを再読み込みする
if dein#load_state(s:dein_dir)
    call dein#begin(s:dein_dir) " 設定開始

    " プラグインリストを収めた TOML ファイル
    " 予め TOML ファイル（後述）を用意しておく
    let g:rc_dir = expand('~/.vim/rc')
    let s:dein_toml = g:rc_dir . '/dein.toml'
    let s:lazy_dein_toml = g:rc_dir . '/lazy_dein.toml'
    let s:lazy_dein_langs_toml = g:rc_dir . '/lazy_dein_langs.toml'

    " TOML を読み込み、キャッシュしておく
    call dein#load_toml(s:dein_toml,      {'lazy': 0})
    call dein#load_toml(s:lazy_dein_toml, {'lazy': 1})
    call dein#load_toml(s:lazy_dein_langs_toml, {'lazy': 1})

    call dein#end() " 設定終了
    call dein#save_state() " キャッシュ保存
endif

" もし、未インストールものものがあったらインストール
if dein#check_install()
    call dein#install()
endif

if has('nvim')
	" 最新のpythonをhostにする
    let g:python_host_prog=sort(split(glob($PYENV_ROOT.'/versions/2.7*/bin/python')))[-1]
    let g:python3_host_prog=sort(split(glob($PYENV_ROOT.'/versions/3.6*/bin/python')))[-1]
endif

syntax on
" colorscheme dracula
colorscheme spring-night

augroup autoreload
    set autoread
    autocmd FocusLost,FocusGained,CursorMoved,CursorMovedI,CursorHold,CursorHoldI  * silent! checktime
augroup END

augroup filetypes
    autocmd BufRead,BufNewFile Dockerfile* setfiletype dockerfile
    autocmd BufRead,BufNewFile *zshrc setfiletype sh
    autocmd BufRead,BufNewFile *.mjs setfiletype javascript
    autocmd BufRead,BufNewFile *.csv setfiletype csv
    autocmd BufWritePre * :%s/\s\+$//ge
augroup END

set expandtab                   " タブをスペースにする
set tabstop=4
set shiftwidth=4
augroup indentsize
    autocmd FileType sh setlocal shiftwidth=2 tabstop=2
    autocmd FileType vue setlocal shiftwidth=2 tabstop=2
    autocmd FileType blade setlocal shiftwidth=2 tabstop=2
    autocmd FileType yaml setlocal shiftwidth=2 tabstop=2
    autocmd FileType javascript setlocal shiftwidth=2 tabstop=2
    autocmd FileType typescript setlocal shiftwidth=2 tabstop=2
    autocmd FileType json setlocal shiftwidth=2 tabstop=2 conceallevel=0
    autocmd FileType html setlocal shiftwidth=2 tabstop=2
    autocmd FileType go setlocal shiftwidth=4 tabstop=4 noexpandtab
    autocmd FileType vim setlocal shiftwidth=4 tabstop=4 noexpandtab
    autocmd FileType makefile setlocal noexpandtab
    autocmd FileType gitconfig setlocal noexpandtab
    autocmd FileType vue :syntax sync fromstart
augroup END

if ! exists('veonim')
	hi! Normal ctermbg=NONE guibg=NONE
	hi! NonText ctermbg=NONE guibg=NONE
endif

hi! SpecialKey ctermfg=239 ctermbg=NONE
" hi! ALEWarning guibg=#99FFCC guifg=white gui=underline ctermbg=NONE ctermfg=white cterm=underline
" hi! ALEError guibg=#FF5555 guifg=white gui=underline ctermbg=NONE  ctermfg=white cterm=underline
hi! CursorLine guibg=NONE guifg=NONE ctermfg=NONE ctermbg=NONE cterm=underline gui=underline
hi! ALEWarning guibg=NONE guifg=#87ff5f gui=underline ctermbg=NONE ctermfg=119 cterm=underline
hi! ALEError guibg=NONE guifg=#FF5555 gui=underline ctermbg=NONE  ctermfg=207 cterm=underline
hi! ALEErrorSign ctermbg=207 ctermfg=NONE guibg=#FF5555 guifg=NONE
hi! ALEWarningSign ctermbg=119 ctermfg=NONE guibg=#87ff5f guifg=NONE
hi! CursorIM ctermfg=16 ctermbg=127 guifg=#000000 guibg=#af00af
hi! MatchParen guifg=208 gui=bold
hi! HighlightedyankRegion cterm=reverse gui=reverse
" ファイルタイププラグインおよびインデントを有効化
filetype plugin indent on
